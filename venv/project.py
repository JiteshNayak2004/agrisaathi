from flask import Flask, request,render_template,jsonify
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
import pickle
# from PIL import Image
# from numpy import asarray
# import keras
# from keras.models import load_model
# import tensorflow as tf
# import cv2

app = Flask(__name__)
model=pickle.load(open('crop_recommender.pkl','rb'))
# model1=pickle.load(open('All.pkl','rb'))
# model1=tf.keras.model.load_model('Apple.h5')

@app.route('/')
def index():
    return render_template("index.html")

@app.route('/data',methods=['POST'])
def predict():
    int_features=[float(x) for x in request.form.values()]
    # print ("printing"+request.values.get("N"))
    final_features=[np.array(int_features)]
    prediction=model.predict(final_features)
    # print(prediction)
    output=prediction[0]
    print("Crop we recommend you to grow : "+output)
    crop={"rice":"1 - Preparing the land Farmers get to work on the fields and will try to finish all the preparations before the rainy season. First, they begin to pull out the weeds so that the main crop would receive all the nutrition from the soil. Once this is done, the field is tilled by buffaloes to a certain inch. We then add natural manure to the land to improve the fertility of the soil. Finally, the land is covered with water for about 2 - 2.5 cm before the seedlings are sown. 2 - Transplanting the paddy seedlings Usually, the seedlings are first grown in a nursery and then transferred to the fields after forty days. In some regions, it is directly sown in the fields. However, the yield from transplanting is significantly higher than that of direct sowing. 3 - Maintenance of the field Paddy requires utmost attention and regular maintenance. The crop needs to be spaced out so that they derive equal nutrition from the soil. Our farmers will also regulate the water level in the soil depending on the growth of the crop. 4 - Harvesting Harvesting is done during the dry season. The farmers use the traditional curved knife and this process is very labor-intensive. Once this process is finished, our farmers will finally separate the rice grains from the husk through threshing, milling, and winnowing.","maize":"Step 1: Field selection There are three key aspects of field selection: Altitude: Maize is a sub-tropical plant and the altitude at which it is grown is critical to its ability to mature. Wherever the crop is grown above 140m there must be other factors to favour of growing at this height, such south-facing and free-draining soil. Aspect: Aim for south-facing sites that are not too exposed. Soil type: Maize needs a dry soil in the spring, but not a soil type that will dry out too much in late spring when the young plants are developing. Growing maize on heavy, clay-type soils is probably the biggest handicap to trying to get the best out of this crop because of the difficulty in creating the correct seed-bed in the spring. Medium loams that are easy to work in the spring, free-draining and will warm up early in the season to enable the young plants to get the best possible start are the most favoured. Very free-draining and light, sandy soils can be too extreme. Step 2: Seed-bed preparation The aim is to achieve a deep, loose seed-bed. Maize is a free-rooting plant so there needs to be no restriction on root development in the early stages. Crops that struggle with compaction then struggle to mature and achieve optimum yield. Farms with heavy soils often need to winter plough to achieve the correct seed-bed in the spring. But if there is a wet March, water can hold under the furrows and can take a long time to dry out. The topsoil can look dry and good, but it’s important to look deeper down and see what conditions are really like. See also: Dairy farmer increases maize yields by upping seed rates Crumblers and other machinery that will cultivate the ground to achieve the openness of the soil that maize requires for sowing should be used rather than any kit that will compact the bed. Being able to kick a foot through soils is a good guide. Step 3: Drilling and sowing Maize seed should be drilled to a uniform depth and into moisture. Soil temperatures should by 8C first thing in the morning for four to five consecutive days for maize to grow.  The last 10 days of April should see all maize drilled, but climate will obviously depend on location. There is an old adage that says for every day that the crop is sown into the month of May there will be a 1% loss in yield. With seed treatments likely to be banned next year (2020), farmers should drill deeper to avoid rook damage. Seed must be deeper than a rook’s beak and so should be sown into the seedbed at least 7-8cm.","pigeonpeas":"Pigeon peas are tough little plants that will grow through drought, poor soil, and lots of heat. Here’s the thing, though. While they can survive those conditions, they’ll produce more abundantly and be healthier when you provide them with better resources. If possible, start with well-draining soil, and plant in a full sun area.","blackgram":"Black gram can be grown on variety of soils ranging from sandy soils to heavy cotton soils. The most ideal soil is a well drained loam with pH of 6.5 to 7.8. Black gram cannot be grown on alkaline and saline soils. Land is prepared like any other kharif season pulse crop. However during summer it requires a thorough preparation to give a pulverized free from stubbles and weeds completely.","lentil":"ClimateLentil requires cold climate. It is very hardy and can tolerate frost and severe winter to a great extent. It require cold temperature during its vegetative growth and warm temperature at the time of maturity. The optimum temperature for growth is 18-300 C. Its range of cultivation extends to an altitude of 3,500 m in north-west hills.Soil Type and Field Preparation Well drained, loam soils with neutral reaction are best for lentil cultivation. Acidic soils are not fit for growing lentil. The soil should be friable and weed free so that seeding could be done at uniform depth.On heavy soils, one deep ploughing followed by two to three cross harrowing should be done. After harrowing, the field should be levelled by giving a gentle slope to ease irrigation.","pomegrenate":"When picking a location for your tree, try to find a well-drained area with sandy loam soil. This is the best for pomegranates, but as long as there is good drainage your tree should thrive. Place your tree in full sun for the best growth and production rate. Avoid frost pockets- trees may be damaged by unseasonable frosts. Pomegranates prefer alkaline soil (pH 6.5 to 7.0 or higher). If you have questions about your soil, take a sample down to the Cooperative Extension Agent in your county.","banana":"• Banana can grow from the poorest to the richest type of soil with varying success. • The soil should be tested before banana cultivation • The soil should have good drainage, adequate fertility and moisture. • Deep, rich loamy  and salty clay loam soil with pH between 6-7.5 is most preferred for banana cultivation. • Ill drained, poorly aerated and nutritionally deficient soils are not suitable for banana. • Extreme clayey, Sandy soil, Saline soil and Calcareous soil is not suitable for Banana cultivation. • Avoided soil of low lying areas, very sandy & heavy black cotton with ill drainage. • A soil that is not too acidic & not too alkaline, rich in organic material with high nitrogen content, adequate phosphorus level and plenty of potash are good for banana. Field Preparation • Wetlands:  no preparatory cultivation is needed • Garden lands: 2-4 ploughings are required ","mango":"When to Plant The best time to plant a mango tree is in the spring when the weather is still mild. However, be sure it will not be exposed to any frost","grapes":"• Grapevines should be planted in early spring after the date of the last hard freeze has past. Vines are usually purchased as dormant, bare-root plants. • Most grape varieties are self-fertile. To be sure, ask when you are buying vines if you will need more than one plant for pollination. Select a site with full sun. If you don’t have a spot with full sun, make sure it at least gets morning sun. A small amount of afternoon shade won’t hurt. Your soil needs to be deep, well-drained, and loose. You also need good air circulation.","watermelon":"When should I plant watermelon? \n Watermelon requires a relatively long growing season (about 80-90 days from sowing the seeds), and it wants absolutely nothing to do with cool weather. Plant your watermelon when the soil has warmed to around 70ºF and there are no longer any cool nights in the forecast. For many people, this is actually two to three weeks after their last frost date in the spring.\nWhen to Plant Watermelon Seeds?\nInput your average last frost date for your area to figure out exactly when to plant your watermelon seeds","apple":"Climate:\nThe apple is a temperate fruit crop. However, in India the apple growing areas do not fall in temperate zone but the prevailing temperate climate of the region is due to the Himalayan ranges and high altitudes. The average summer temperature should be around 21-24oC during active growth period. Apple succeeds best in regions where the trees experience uninterrupted rest in winter and abundant sunshine for good colour development. It can be grown at an altitude of 1500- 2700 m above the sea level. Well-distributed rainfall of 1000-1250 mm throughout the growing season is most favourable for optimum growth and fruitfulness of apple trees. Varieties :1. Jammu and Kashmir : Golden Delicious (Late Season), Lal Ambri, Mollies Delicious, Starkrimson, Red June, Irish Peach, Benoni and Tydeman’s Early. 2. Himachal Pradesh : Golden Delicious (Late Season), Red Delicious (Mid season), McIntosh. 3. Uttarakhand, Uttar Pradesh : McIntosh, Chaubattia Anupam.4. Tamil Nadu : Irish Peach and Zouches Pipin (Early); KKL 1, Carrington and Winterstein (Mid -season); Rome Beauty and Parlin’s Beauty (late).Soil:Apples grow best on a well-drained, loam soils having a depth of 45 cm and a pH range of pH 5.5-6.5. The soil should be free from hard substrata and water-logged conditions. Soils with heavy clay or compact subsoil are to be avoided.","muskmelon":"SOIL: It grows well in deep fertile and well-drained soil. It gives best result when grown on well drained loam soil. Soil having poor drainage capacity is not suited for Muskmelon cultivation. Follow crop rotation as continuous growing of same crop on same field leads loss of nutrients, poor yield and more disease attack. pH of soil should be in between 6-7. Alkaline soil with high salt concentration is not suitable for cultivation. LAND PREPARATION:Plough land and bring to fine tilth. In North India, sowing is done in middle of February month. In North east and west India sowing is done during November to January.","orange":"Orange Tree Care:Orange trees require plenty of sunshine and warmth; key factors for producing sweeter fruit. They are susceptible to wind damage so some protection is needed. Since these trees can grow fairly large, depending on variety, space them about 20 feet apart. For dwarf varieties, 10 feet should be sufficient.Orange trees are self-fertile and do not require another orange tree to produce fruits. However, including more than one orange tree in your garden will attract more pollinators which can increase fruit production.Light:Orange trees require plenty of sunshine and warmth to produce the best-tasting fruits, so choose a spot that receives full sun for eight hours a day. For dwarf varieties grown indoors, place them in a sunny window. Soil:Orange trees thrive in loamy, rich, well-draining soil. It is important that excess water drains away, as orange trees cannot tolerate heavy, wet soil. When planting these trees, you can mix in potting soil for additional nutrients. Slightly acidic to neutral soil pH levels from 6.0 to 7.0 work best.","papaya":"Growing papaya trees is generally done from seed that is extracted from ripe fruit. If you are using fruit from a grocery store, it is most likely going to be a bisexual plant. You should plant several seeds per pot to ensure germination. Under full sunlight, seedlings may emerge in about two weeks. Plants can be set out after they are a foot (0.5 m.) tall and spaced 8 to 10 feet (2.5-3 m.) apart. The seedlings will flower after five or six months. When considering the best papaya growing conditions in the home landscape, don’t forget about planting location. The best place to plant papaya is on the south or southeast side of a house with some protection from wind and cold weather. Papayas also grow best in full sun.","coconut":"Introduction: The coconut palm is referred to as 'Kalpavriksha' - the 'tree of heaven' as each and every part of the palm is useful to mankind in one way or other. It provides food, drink, fuel and timber. Millions of families in India depend on coconut for their livelihood either directly or indirectly India ranks third in area and production of coconut in the world. The four southern states viz . Kerala, Tamil Nadu, Karnataka and Andhra Pradesh are the major coconut producing states in India accounting for more than 90 per cent of area and production. There is a great scope for enhancing the productivity of coconut through adoption of scientific cultivation technologies, which are described here under.Climate and soil: The coconut palm is found to grow under varying climatic and soil conditions. It is essentially a tropical plant, growing most!y between 20° N and 20° S latitudes. The ideal temperature for coconut growth and yield is 27 ± 5° C and humidity > 60 per cent. The coconut palm grows well upto an elevation of 600 m above MSL. However, near the equator, productive coconut plantations can be established up to an elevation of about 1000 m above MSL. The palms tolerate wide range in intensity and distribution of rainfall. However, a well distributed rainfall of about 200 cm per year is the best for proper growth and higher yield. In areas of inadequate rainfall with uneven distribution, irrigation is required.","cotton":"Crop Rotation Group:Miscellaneous ●Soil:Rich soil enriched with plenty of compost.Position:Full sun.Frost tolerant:Cannot tolerate frost.Feeding:Mix a balanced organic fertilizer into the soil before planting cotton. In midsummer when flowering begins, topdress with more fertilizer or drench with a liquid plant food.","jute":"Jute is a rainy season crop, sown from March to May according to rainfall and type of land.  It is harvested from June to September depending upon whether the sowings are early or late.Climate and Soils:Jute requires a warm and humid climate with temperature between 24° C to 37° C.  Constant rain or water-logging is harmful.  The new gray alluvial soil of good depth, receiving salt from annual floods, is best for jute.  Flow ever jute is grown widely in sandy loams and clay loams.","coffee":"In India, coffee is traditionally grown in the Western Ghats spread over Karnataka, Kerala and Tamil Nadu. Coffee cultivation is also being expanding rapidly in the nontraditional areas of Andhra Pradesh and Odisha as well as in the North East states. Coffee is predominantly an export oriented commodity and 65% to 70% of coffee produced in the country is exported while the rest is consumed within the country. Indian coffee has created a niche for itself in the international market and the Indian Coffees are earning high premium, particularly Indian Robusta which is highly preferred for its good blending quality. Arabica Coffee from India is also well received in the international market.Coffee is an export product with low import intensity and high employment content. This is evident from the fact that more than six lakh persons are directly employed and an equal numbers of individuals get indirect employment from this sector.The two main varieties of coffee viz., Arabica and Robusta are grown in India. Arabica is mild coffee, but the beans being more aromatic, it has higher market value compared to Robusta beans. On the other hand Robusta has more strength and is, therefore, used in making various blends. Arabica is grown in higher altitudes than Robusta. The cool and equable temperature, ranging between 15 degree C to 25 degree C, is suitable for Arabica while for Robusta, hot and humid climate with temperature ranging from 20 degree C to 30 degree C is suitable.Arabica requires more care & nurture and is more suitable for large holdings whereas Robusta is suitable irrespective of size of the farm. Arabica is susceptible to pests & diseases such as White Stem Borer, leaf rust etc., and requires more shade than Robusta. The harvest of Arabica takes place between November to January, while for Robusta it is December to February.","chickpea":"4 Tips for Growing Chickpeas:	1. 1. Companion plant. Chickpeas grow well with most garden plants because they are nitrogen-fixers, meaning they have healthy bacteria-filled nodules on their roots that replenish the soil with necessary nitrogen. Popular companion plants include summer savory and cucumbers. However, avoid planting chickpeas next to alliums (especially garlic) because they release a chemical that inhibits growth in legumes. Avoid planting chickpeas too close to plants susceptible to the same diseases, like potatoes or soybean plants.2. Handle in drier conditions. Chickpea plants can be susceptible to fungus, especially when wet, so avoid handling the leaves or pods after rainfall or morning dew, as this can spread the fungus from plant to plant.3. Be gentle when handling the roots. Chickpea plants have shallow root systems, so avoid disturbing their root systems whenever possible. When weeding, be gentle when pulling up roots near the base of the chickpea plants.4. Try inoculation. Some pulse crop growers add an extra step to their planting routine: inoculating the seeds with a special bacteria that helps encourage nitrogen-fixing, strengthens the plant, and improves the yield. Inoculate your chickpeas by mixing the chickpea seeds with the inoculant Rhizobia cicero, which is commercially available at many garden stores. Allow the seeds to dry in the shade before planting","kidneybeans":"When to Grow Kidney Beans:Kidney beans are planted at the very beginning of spring—after the last frost of winter has passed—as they grow best in warm temperatures. When you start growing your beans, the air temperature should be around 65 degrees Fahrenheit, and the soil temperature should be at least 70 to 80 degrees Fahrenheit.How to Grow Kidney Beans:Kidney beans can be grown in a bush or on a pole. Bush beans grow without support in a compact space, either in the ground or in a container. Pole beans require support—like a stake or a trellis—and do best when they’re spaced out in the soil. Pole beans typically yield more beans during a growing season but take longer to be ready to harvest—usually between 10 and 15 days longer than bush beans. Bush variety beans generate all of their produce over a relatively short time period, usually within one to two weeks, after which the plant will cease to produce.","mothbeans":"It is a creeping annual plant and it belongs to the Fabaceae Family.It is also known as Mat bean, Moth bean, Matki, and dew bean.The moth bean crop consists of pods, sprouts and protein rich seeds are mainly consumed in India.It acts as a pasture legume.It is rich in iron, calcium, manganese, zinc, potassium, magnesium and vitamin B9.The seeds of this crop contain 22-24% of protein.It is identified as a most remarkable food source in future because it is unaffected by drought and have a ability to encounter soil erosion","mungbean":"Mung bean seeds are sprouted for use either fresh or canned. These high protein, 21-28% beans are also rich sources of calcium, phosphorus, and other vitamins. For people in regions where animal protein is scarce, mung beans are an important source of protein."}
    # crop={"rice":"1 - Preparing the land Farmers get to work on the fields and will try to finish all the preparations before the rainy season. First, they begin to pull out the weeds so that the main crop would receive all the nutrition from the soil. Once this is done, the field is tilled by buffaloes to a certain inch. We then add natural manure to the land to improve the fertility of the soil. Finally, the land is covered with water for about 2 - 2.5 cm before the seedlings are sown. 2 - Transplanting the paddy seedlings Usually, the seedlings are first grown in a nursery and then transferred to the fields after forty days. In some regions, it is directly sown in the fields. However, the yield from transplanting is significantly higher than that of direct sowing. 3 - Maintenance of the field Paddy requires utmost attention and regular maintenance. The crop needs to be spaced out so that they derive equal nutrition from the soil. Our farmers will also regulate the water level in the soil depending on the growth of the crop. 4 - Harvesting Harvesting is done during the dry season. The farmers use the traditional curved knife and this process is very labor-intensive. Once this process is finished, our farmers will finally separate the rice grains from the husk through threshing, milling, and winnowing.","maize":"Step 1: Field selection There are three key aspects of field selection: Altitude: Maize is a sub-tropical plant and the altitude at which it is grown is critical to its ability to mature. Wherever the crop is grown above 140m there must be other factors to favour of growing at this height, such south-facing and free-draining soil. Aspect: Aim for south-facing sites that are not too exposed. Soil type: Maize needs a dry soil in the spring, but not a soil type that will dry out too much in late spring when the young plants are developing. Growing maize on heavy, clay-type soils is probably the biggest handicap to trying to get the best out of this crop because of the difficulty in creating the correct seed-bed in the spring. Medium loams that are easy to work in the spring, free-draining and will warm up early in the season to enable the young plants to get the best possible start are the most favoured. Very free-draining and light, sandy soils can be too extreme. Step 2: Seed-bed preparation The aim is to achieve a deep, loose seed-bed. Maize is a free-rooting plant so there needs to be no restriction on root development in the early stages. Crops that struggle with compaction then struggle to mature and achieve optimum yield. Farms with heavy soils often need to winter plough to achieve the correct seed-bed in the spring. But if there is a wet March, water can hold under the furrows and can take a long time to dry out. The topsoil can look dry and good, but it’s important to look deeper down and see what conditions are really like. See also: Dairy farmer increases maize yields by upping seed rates Crumblers and other machinery that will cultivate the ground to achieve the openness of the soil that maize requires for sowing should be used rather than any kit that will compact the bed. Being able to kick a foot through soils is a good guide. Step 3: Drilling and sowing Maize seed should be drilled to a uniform depth and into moisture. Soil temperatures should by 8C first thing in the morning for four to five consecutive days for maize to grow.  The last 10 days of April should see all maize drilled, but climate will obviously depend on location. There is an old adage that says for every day that the crop is sown into the month of May there will be a 1% loss in yield. With seed treatments likely to be banned next year (2020), farmers should drill deeper to avoid rook damage. Seed must be deeper than a rook’s beak and so should be sown into the seedbed at least 7-8cm."}
    # return render_template("index.html',prediction_text='Crop we recommend you to grow {}".format(output))
    # print("Crop we recommend you is "+output)
    return render_template('index.html', prediction_text='Crop we recommend you to grow : {}'.format(output),paragraph='{}'.format(crop[output]),about="ABOUT");

@app.route('/disease',methods=['POST'])
def predict1():
    string=request.form.get("img")
    # image=request.files.get('imagefile','')
    # img=Image.open(image)
    # print("Img opened")
    if(string=='Apple'):
        # CATEGORIES = ['Apple Apple scab','Apple Black rot','Apple Cedar apple rust']
        # image=request.files.get('imagefile','')
        image=request.form.get('path')
        img=Image.open("static/00e909aa-e3ae-4558-9961-336bb0f35db3___JR_FrgE.S 8593_90deg.JPG")
        grayscale=img.convert('L')
        img_array=asarray(grayscale)
        # # img_array = cv2.imread(image, cv2.IMREAD_GRAYSCALE)
        img_array=img_array.reshape(-1,256,256,1)
        # prediction=model1.predict(img_array)
        # prediction1 = prediction.tolist()
        # prediction_list = max(prediction1)
        # max_ele=max(prediction_list) 
        # index=prediction_list.index(max_ele)
        # print("Img opened")]
        return render_template('index.html',prediction_text="Img got")
    return render_template('index.html',prediction_text="Img not found")
if __name__ == '__main__':
    app.run(debug=True)